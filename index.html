<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backoff Calculator</title>
    <link rel="stylesheet" href="./styles.css" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
    ></script>
    <script type="module" src="./src/main.js"></script>
  </head>
  <body>
    <main class="app-shell">
      <section class="panel app-panel">
        <header class="app-header">
          <div class="header-row">
            <h1>Retry Backoff Calculator</h1>
            <button
              id="theme-toggle"
              class="theme-toggle"
              type="button"
              aria-label="Switch theme"
              title="Switch theme"
              aria-pressed="false"
            >
              â˜€
            </button>
          </div>
        </header>

        <section class="content-block controls-panel">
          <form id="backoff-form" class="controls-grid" novalidate>
            <fieldset class="field field--full strategy-field" aria-label="Retry strategy">
              <div class="strategy-toggle">
                <input
                  id="strategy-exponential"
                  type="radio"
                  name="strategy"
                  value="exponential"
                  checked
                />
                <label for="strategy-exponential" class="strategy-option">Exponential</label>

                <input id="strategy-linear" type="radio" name="strategy" value="linear" />
                <label for="strategy-linear" class="strategy-option">Linear</label>
              </div>
            </fieldset>

            <label class="field">
              <span>Initial Delay (ms)</span>
              <input
                id="initialDelayMs"
                name="initialDelayMs"
                aria-describedby="error-initialDelayMs"
                type="number"
                min="0"
                value="500"
                step="any"
              />
              <span id="error-initialDelayMs" class="field-error" aria-live="polite"></span>
            </label>

            <label class="field">
              <span>Max Retries (excludes initial request)</span>
              <input
                id="maxRetries"
                name="maxRetries"
                aria-describedby="error-maxRetries"
                type="number"
                min="0"
                step="1"
                inputmode="numeric"
                value="5"
              />
              <span id="error-maxRetries" class="field-error" aria-live="polite"></span>
            </label>

            <label class="field">
              <span>Max Delay Cap (ms, optional)</span>
              <input
                id="maxDelayMs"
                name="maxDelayMs"
                aria-describedby="error-maxDelayMs"
                type="number"
                min="0"
                step="any"
              />
              <span id="error-maxDelayMs" class="field-error" aria-live="polite"></span>
            </label>

            <label id="factor-group" class="field strategy-only">
              <span>Backoff Factor (&gt; 1)</span>
              <input
                id="factor"
                name="factor"
                aria-describedby="error-factor"
                type="number"
                min="1.0001"
                step="any"
                value="2"
              />
              <span id="error-factor" class="field-error" aria-live="polite"></span>
            </label>

            <label id="increment-group" class="field strategy-only" hidden>
              <span>Linear Increment (ms)</span>
              <input
                id="incrementMs"
                name="incrementMs"
                aria-describedby="error-incrementMs"
                type="number"
                min="0"
                step="any"
                value="500"
              />
              <span id="error-incrementMs" class="field-error" aria-live="polite"></span>
            </label>
          </form>
        </section>

        <section class="content-block chart-panel">
          <div class="chart-frame">
            <canvas id="delay-chart" aria-label="Retry delay chart" role="img"></canvas>
          </div>
        </section>

        <section class="content-block summary-panel">
          <div class="summary-grid">
            <article class="summary-card">
              <h3>Total Retries</h3>
              <p id="summary-total-retries">-</p>
            </article>
            <article class="summary-card">
              <h3>Final Retry Delay</h3>
              <p id="summary-final-delay">-</p>
            </article>
            <article class="summary-card">
              <h3>Total Cumulative Wait</h3>
              <p id="summary-total-delay">-</p>
            </article>
          </div>
        </section>

        <section class="content-block table-panel">
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Retry #</th>
                  <th>Raw Delay (ms)</th>
                  <th>Capped Delay (ms)</th>
                  <th>Cumulative Delay (ms)</th>
                </tr>
              </thead>
              <tbody id="schedule-body">
                <tr>
                  <td class="placeholder-cell" colspan="4">
                    Adjust inputs to generate a schedule.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
      </section>
    </main>
  </body>
</html>
